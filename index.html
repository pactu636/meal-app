<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>Plate</title>
  
  <!-- iOS PWA Meta Tags -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Plate">
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <style>
    :root {
      --orange: #FF6B35;
      --orange-dark: #E85A2A;
    }

    body {
      -webkit-tap-highlight-color: transparent;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      user-select: none;
      background: #0a0a0a;
      margin: 0;
      padding: 0;
      overflow: hidden;
      position: fixed;
      width: 100%;
      height: 100vh;
    }
    
    .orange-accent {
      color: var(--orange);
    }
    
    .orange-bg {
      background: var(--orange);
    }
    
    .orange-bg:active {
      background: var(--orange-dark);
    }
    
    .checkbox {
      width: 24px;
      height: 24px;
      border: 2px solid var(--orange);
      border-radius: 50%;
      display: inline-block;
      position: relative;
      flex-shrink: 0;
    }
    
    .checkbox.checked {
      background-color: var(--orange);
      border-color: var(--orange);
    }
    
    .checkbox.checked::after {
      content: 'âœ“';
      position: absolute;
      color: white;
      font-size: 16px;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }

    .meal-card {
      background: linear-gradient(135deg, #1a1a1a 0%, #0f0f0f 100%);
      border: 1px solid #2a2a2a;
    }

    .meal-card:active {
      transform: scale(0.98);
    }

    .recipe-section {
      margin-bottom: 2rem;
    }

    .recipe-section h3 {
      color: var(--orange);
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 1rem;
    }

    .recipe-list {
      list-style: none;
      padding: 0;
    }

    .recipe-list li {
      padding: 0.75rem 0;
      border-bottom: 1px solid #2a2a2a;
      display: flex;
      align-items: flex-start;
      gap: 1rem;
    }

    .recipe-list li:last-child {
      border-bottom: none;
    }

    .recipe-list li::before {
      content: 'â€¢';
      color: var(--orange);
      font-size: 1.5rem;
      line-height: 1;
      flex-shrink: 0;
    }

    .instruction-number {
      background: var(--orange);
      color: white;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 0.875rem;
      flex-shrink: 0;
    }

    .toast {
      position: fixed;
      top: calc(env(safe-area-inset-top) + 2rem);
      left: 50%;
      transform: translateX(-50%);
      background: #1a1a1a;
      border: 1px solid #2a2a2a;
      padding: 1rem 1.5rem;
      border-radius: 1rem;
      z-index: 10000;
      box-shadow: 0 10px 40px rgba(0,0,0,0.5);
      max-width: 90%;
      opacity: 0;
      transition: opacity 0.3s ease-out;
    }

    .toast.show {
      opacity: 1;
    }

    .toast.success {
      border-color: var(--orange);
    }

    .toast.error {
      border-color: #ef4444;
    }

    .tab-panel::-webkit-scrollbar {
      display: none;
    }
    
    .tab-panel {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
  </style>
</head>
<body class="bg-black text-white">

  <!-- Main Container -->
  <div id="app" class="max-w-2xl mx-auto h-full flex flex-col">
    
    <!-- Tab Content -->
    <div class="flex-1 overflow-hidden relative">
      
      <!-- MEALS TAB -->
      <div id="meals-tab" class="tab-panel absolute inset-0 overflow-y-auto">
        <!-- Header -->
        <div class="sticky top-0 bg-black z-10 p-4 border-b border-gray-800" style="padding-top: calc(env(safe-area-inset-top) + 2rem);">
          <h1 class="text-3xl font-bold mb-1">Plate</h1>
          <p class="text-gray-400 text-sm" id="current-date"></p>
        </div>
        
        <!-- Today's Meals -->
        <div id="meals-container" class="p-4 space-y-3 pb-24">
          <!-- Meals will be rendered here -->
        </div>
      </div>
      
      <!-- SHOPPING TAB -->
      <div id="shopping-tab" class="tab-panel absolute inset-0 overflow-y-auto hidden">
        <div class="sticky top-0 bg-black z-10 p-4 border-b border-gray-800" style="padding-top: calc(env(safe-area-inset-top) + 2rem);">
          <h1 class="text-3xl font-bold mb-1">Shopping</h1>
          <p class="text-gray-400 text-sm" id="shopping-week-label"></p>
        </div>
        <div id="shopping-list-container" class="p-4 pb-24">
          <!-- Shopping list will be rendered here -->
        </div>
      </div>
      
      <!-- SETTINGS TAB -->
      <div id="settings-tab" class="tab-panel absolute inset-0 overflow-y-auto hidden">
        <div class="p-4 pb-24" style="padding-top: calc(env(safe-area-inset-top) + 2rem);">
          <h1 class="text-3xl font-bold mb-4">Settings</h1>
          
          <div class="mb-6">
            <label class="block text-sm font-medium mb-2 text-gray-400">Upload JSON File</label>
            <label for="json-file-input" class="block w-full p-3 rounded-xl bg-zinc-900 border border-gray-700 text-center font-medium cursor-pointer mb-2 hover:bg-zinc-800 active:bg-zinc-700">
              Choose File
            </label>
            <input type="file" id="json-file-input" accept=".json" class="hidden">
            <p id="file-name-display" class="text-sm text-gray-500 mb-3 text-center hidden"></p>
            <button id="upload-json-btn" class="w-full orange-bg text-white p-3 rounded-xl font-medium">Upload & Load JSON</button>
          </div>
          
          <div class="mb-6">
            <label class="block text-sm font-medium mb-2 text-gray-400">Download Current Data</label>
            <button id="download-json-btn" class="w-full bg-zinc-800 text-white p-3 rounded-xl font-medium mb-4">Download JSON File</button>
          </div>

          <div class="mb-6">
            <button id="reset-data-btn" class="w-full bg-red-600 text-white p-3 rounded-xl font-medium active:bg-red-700">Reset to Default</button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Bottom Tab Bar -->
    <div class="bg-zinc-900 border-t border-gray-800 flex-shrink-0">
      <div class="max-w-2xl mx-auto flex">
        <button class="tab-btn flex-1 p-4 flex flex-col items-center gap-1 orange-accent" data-tab="meals">
          <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
            <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
          </svg>
          <span class="text-xs">Today</span>
        </button>
        <button class="tab-btn flex-1 p-4 flex flex-col items-center gap-1 text-gray-500" data-tab="shopping">
          <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
            <path d="M3 1a1 1 0 000 2h1.22l.305 1.222a.997.997 0 00.01.042l1.358 5.43-.893.892C3.74 11.846 4.632 14 6.414 14H15a1 1 0 000-2H6.414l1-1H14a1 1 0 00.894-.553l3-6A1 1 0 0017 3H6.28l-.31-1.243A1 1 0 005 1H3zM16 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM6.5 18a1.5 1.5 0 100-3 1.5 1.5 0 000 3z"/>
          </svg>
          <span class="text-xs">Shopping</span>
        </button>
        <button class="tab-btn flex-1 p-4 flex flex-col items-center gap-1 text-gray-500" data-tab="settings">
          <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"/>
          </svg>
          <span class="text-xs">Settings</span>
        </button>
      </div>
    </div>
  </div>
  
  <!-- Full Screen Recipe Modal -->
  <div id="recipe-modal" class="hidden fixed inset-0 z-50 bg-black">
    <div class="h-full flex flex-col">
      <div class="sticky top-0 bg-black/90 backdrop-blur-lg p-4 border-b border-gray-800 flex items-center gap-3 z-10 flex-shrink-0" style="padding-top: calc(env(safe-area-inset-top) + 1.5rem); min-height: calc(env(safe-area-inset-top) + 4.5rem);">
        <button id="close-modal" class="text-3xl leading-none p-2 -ml-2">&larr;</button>
        <h2 id="modal-title" class="text-xl font-semibold flex-1"></h2>
      </div>
      <div id="modal-content" class="p-6 flex-1 overflow-y-auto"></div>
    </div>
  </div>

  <script>
    // DEFAULT DATA - Using the Spring Week 1 structure as default
    const DEFAULT_DATA = {
      "Spring": {
        "Week 1": {
          "Monday": {
            "Breakfast": { "name": "Greek Yogurt Power Bowl", "recipe": "Ingredients:\n- 2 cups Greek yogurt\n- 3 tbsp honey\n- 1/4 cup walnuts\n- Fresh mint leaves\n\nInstructions:\n1. Layer Greek yogurt in bowl\n2. Drizzle with honey\n3. Top with crushed walnuts and torn mint leaves" },
            "Lunch": { "name": "Mediterranean Tuna Pita Bowl", "recipe": "Ingredients:\n- 2 cans tuna in olive oil\n- 2 whole wheat pitas, torn\n- Cherry tomatoes\n- Cucumber\n- Olives\n\nInstructions:\n1. Combine all ingredients\n2. Dress with olive oil and lemon" },
            "Snack": { "name": "Hummus & Veggies", "recipe": "Ingredients:\n- Hummus\n- Veggie sticks\n- Feta\n\nInstructions:\n1. Serve all together" },
            "Dinner": { "name": "Lemon Herb Salmon", "recipe": "Ingredients:\n- Salmon\n- Vegetables\n- Rice\n- Lemon, herbs\n\nInstructions:\n1. Roast vegetables\n2. Add salmon\n3. Serve over rice" }
          },
          "Tuesday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } },
          "Wednesday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } },
          "Thursday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } },
          "Friday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } },
          "Saturday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } },
          "Sunday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } },
          "shopping_list": []
        },
        "Week 2": { "Monday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Tuesday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Wednesday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Thursday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Friday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Saturday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Sunday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "shopping_list": [] },
        "Week 3": { "Monday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Tuesday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Wednesday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Thursday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Friday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Saturday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Sunday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "shopping_list": [] },
        "Week 4": { "Monday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Tuesday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Wednesday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Thursday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Friday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Saturday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Sunday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "shopping_list": [] }
      },
      "Summer": {
        "Week 1": { "Monday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Tuesday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Wednesday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Thursday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Friday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Saturday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Sunday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "shopping_list": [] },
        "Week 2": { "Monday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Tuesday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Wednesday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Thursday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Friday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Saturday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Sunday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "shopping_list": [] },
        "Week 3": { "Monday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Tuesday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Wednesday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Thursday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Friday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Saturday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Sunday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "shopping_list": [] },
        "Week 4": { "Monday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Tuesday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Wednesday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Thursday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Friday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Saturday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Sunday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "shopping_list": [] }
      },
      "Autumn": {
        "Week 1": { "Monday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Tuesday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Wednesday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Thursday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Friday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Saturday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Sunday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "shopping_list": [] },
        "Week 2": { "Monday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Tuesday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Wednesday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Thursday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Friday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Saturday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Sunday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "shopping_list": [] },
        "Week 3": { "Monday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Tuesday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Wednesday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Thursday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Friday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Saturday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Sunday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "shopping_list": [] },
        "Week 4": { "Monday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Tuesday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Wednesday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Thursday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Friday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Saturday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Sunday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "shopping_list": [] }
      },
      "Winter": {
        "Week 1": { "Monday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Tuesday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Wednesday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Thursday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Friday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Saturday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Sunday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "shopping_list": [] },
        "Week 2": { "Monday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Tuesday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Wednesday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Thursday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Friday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Saturday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Sunday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "shopping_list": [] },
        "Week 3": { "Monday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Tuesday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Wednesday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Thursday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Friday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Saturday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Sunday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "shopping_list": [] },
        "Week 4": { "Monday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Tuesday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Wednesday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Thursday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Friday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Saturday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "Sunday": { "Breakfast": { "name": "Breakfast", "recipe": "" }, "Lunch": { "name": "Lunch", "recipe": "" }, "Snack": { "name": "Snack", "recipe": "" }, "Dinner": { "name": "Dinner", "recipe": "" } }, "shopping_list": [] }
      }
    };

    let appData = JSON.parse(JSON.stringify(DEFAULT_DATA));
    let checkedItems = {};

    // UNCOMMENT THESE 3 LINES FOR LOCALSTORAGE ON YOUR IPHONE:
    const storedData = localStorage.getItem('plate_data');
    if (storedData) appData = JSON.parse(storedData);
    const storedChecked = localStorage.getItem('plate_checked'); if (storedChecked) checkedItems = JSON.parse(storedChecked);

    let currentSeason = 'Spring';
    let currentWeek = 'Week 1';
    let currentTab = 'meals';

    function getCurrentSeason() {
      const now = new Date();
      const month = now.getMonth();
      const day = now.getDate();
      
      if ((month === 2 && day >= 20) || month === 3 || month === 4 || (month === 5 && day < 21)) {
        return { season: 'Spring', startMonth: 2, startDay: 20 };
      }
      if ((month === 5 && day >= 21) || month === 6 || month === 7 || (month === 8 && day < 22)) {
        return { season: 'Summer', startMonth: 5, startDay: 21 };
      }
      if ((month === 8 && day >= 22) || month === 9 || month === 10 || (month === 11 && day < 21)) {
        return { season: 'Autumn', startMonth: 8, startDay: 22 };
      }
      return { season: 'Winter', startMonth: 11, startDay: 21 };
    }

    function getDaysIntoSeason() {
      const now = new Date();
      const { season, startMonth, startDay } = getCurrentSeason();
      
      let year = now.getFullYear();
      if (season === 'Winter' && now.getMonth() < 6) {
        year--;
      }
      
      const seasonStart = new Date(year, startMonth, startDay);
      const diffTime = now - seasonStart;
      const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24)) + 1;
      
      return diffDays;
    }

    function syncWithCalendar() {
      const { season } = getCurrentSeason();
      const daysInto = getDaysIntoSeason();
      
      if (daysInto > 84) {
        return { isFreeDay: true };
      }
      
      const dayInCycle = ((daysInto - 1) % 28) + 1;
      
      let week;
      if (dayInCycle <= 7) week = 'Week 1';
      else if (dayInCycle <= 14) week = 'Week 2';
      else if (dayInCycle <= 21) week = 'Week 3';
      else week = 'Week 4';
      
      currentSeason = season;
      currentWeek = week;
      
      return { isFreeDay: false, season, week };
    }

    function saveData() {
      localStorage.setItem('plate_data', JSON.stringify(appData));
    }

    function saveCheckedItems() {
      localStorage.setItem('plate_checked', JSON.stringify(checkedItems));
    }

    function getCurrentDay() {
      const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
      return days[new Date().getDay()];
    }

    function formatDate() {
      const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
      return new Date().toLocaleDateString('en-US', options);
    }

    function getWeekData() {
      return appData[currentSeason]?.[currentWeek] || {};
    }

    function getTodayMeals() {
      const today = getCurrentDay();
      const weekData = getWeekData();
      return weekData[today] || {};
    }

    function getShoppingList(season, week) {
      return appData[season]?.[week]?.shopping_list || [];
    }

    function parseRecipe(recipeText) {
      if (!recipeText) return '<p class="text-gray-400">No recipe available</p>';
      
      const lines = recipeText.split('\n').filter(line => line.trim());
      let html = '';
      let currentSection = '';
      let items = [];

      lines.forEach(line => {
        if (line.includes('Ingredients:')) {
          if (currentSection && items.length > 0) {
            html += formatSection(currentSection, items);
            items = [];
          }
          currentSection = 'Ingredients';
        } else if (line.includes('Instructions:')) {
          if (currentSection && items.length > 0) {
            html += formatSection(currentSection, items);
            items = [];
          }
          currentSection = 'Instructions';
        } else if (line.trim().startsWith('-') || /^\d+\./.test(line.trim())) {
          items.push(line.replace(/^[-\d.]\s*/, '').trim());
        }
      });

      if (currentSection && items.length > 0) {
        html += formatSection(currentSection, items);
      }

      return html || '<p class="text-gray-400">No recipe available</p>';
    }

    function formatSection(title, items) {
      let html = `<div class="recipe-section">`;
      html += `<h3>${title}</h3>`;
      
      if (title === 'Instructions') {
        html += `<div class="space-y-3">`;
        items.forEach((item, idx) => {
          html += `
            <div class="flex gap-3 items-start">
              <div class="instruction-number">${idx + 1}</div>
              <p class="text-gray-300 flex-1 pt-0.5">${item}</p>
            </div>
          `;
        });
        html += `</div>`;
      } else {
        html += `<ul class="recipe-list">`;
        items.forEach(item => {
          html += `<li class="text-gray-300">${item}</li>`;
        });
        html += `</ul>`;
      }
      
      html += `</div>`;
      return html;
    }

    function showToast(message, type = 'success') {
      const existing = document.querySelector('.toast');
      if (existing) existing.remove();
      
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.textContent = message;
      document.body.appendChild(toast);
      
      setTimeout(() => toast.classList.add('show'), 10);
      
      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 300);
      }, 2500);
    }

    function renderMeals() {
      const container = document.getElementById('meals-container');
      document.getElementById('current-date').textContent = formatDate();
      
      const { isFreeDay } = syncWithCalendar();
      
      if (isFreeDay) {
        const { season } = getCurrentSeason();
        container.innerHTML = `
          <div class="text-center py-12">
            <div class="text-6xl mb-4">ðŸŽ‰</div>
            <h2 class="text-2xl font-bold mb-2">Free Day!</h2>
            <p class="text-gray-400">Enjoy your day off from the meal plan</p>
            <p class="text-sm text-gray-500 mt-4">You're in ${season} season, past day 84</p>
            <p class="text-sm text-gray-500">The cycle will reset when the next season begins</p>
          </div>
        `;
        return;
      }

      const todayMeals = getTodayMeals();
      const meals = ['Breakfast', 'Lunch', 'Snack', 'Dinner'];
      
      container.innerHTML = meals.map(meal => {
        const mealData = todayMeals[meal] || { name: 'Not set', recipe: '' };
        return `
          <button class="meal-card w-full text-left p-6 rounded-2xl transition-transform meal-btn" data-meal="${meal}">
            <div class="text-xs orange-accent uppercase tracking-wide mb-2">${meal}</div>
            <div class="text-xl font-semibold">${mealData.name}</div>
          </button>
        `;
      }).join('');

      document.querySelectorAll('.meal-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const meal = btn.dataset.meal;
          showRecipeModal(meal);
        });
      });
    }

    function renderShoppingList() {
      const container = document.getElementById('shopping-list-container');
      document.getElementById('shopping-week-label').textContent = `${currentSeason} - ${currentWeek}`;
      const list = getShoppingList(currentSeason, currentWeek);
      const checkKey = `${currentSeason}-${currentWeek}`;
      
      if (!checkedItems[checkKey]) checkedItems[checkKey] = {};

      if (list.length === 0) {
        container.innerHTML = '<div class="text-center text-gray-500 py-8">No items in shopping list</div>';
        return;
      }

      container.innerHTML = `
        <div class="space-y-2">
          ${list.map((item, idx) => {
            const isChecked = checkedItems[checkKey][idx] || false;
            return `
              <button class="shopping-item w-full flex items-center gap-3 p-4 rounded-xl bg-zinc-900 text-left transition-transform active:scale-98" data-idx="${idx}">
                <div class="checkbox ${isChecked ? 'checked' : ''}"></div>
                <span class="${isChecked ? 'line-through text-gray-500' : ''}">${item}</span>
              </button>
            `;
          }).join('')}
        </div>
      `;

      document.querySelectorAll('.shopping-item').forEach(btn => {
        btn.addEventListener('click', () => {
          const idx = btn.dataset.idx;
          checkedItems[checkKey][idx] = !checkedItems[checkKey][idx];
          saveCheckedItems();
          renderShoppingList();
        });
      });
    }

    function showRecipeModal(meal) {
      const todayMeals = getTodayMeals();
      const mealData = todayMeals[meal] || { name: 'Not set', recipe: '' };
      
      document.getElementById('modal-title').textContent = mealData.name;
      document.getElementById('modal-content').innerHTML = parseRecipe(mealData.recipe);
      document.getElementById('recipe-modal').classList.remove('hidden');
      document.body.style.overflow = 'hidden';
    }

    function closeRecipeModal() {
      document.getElementById('recipe-modal').classList.add('hidden');
      document.body.style.overflow = '';
    }

    function switchTab(tabName) {
      currentTab = tabName;
      
      document.querySelectorAll('.tab-panel').forEach(panel => panel.classList.add('hidden'));
      document.getElementById(`${tabName}-tab`).classList.remove('hidden');
      
      document.querySelectorAll('.tab-btn').forEach(btn => {
        if (btn.dataset.tab === tabName) {
          btn.classList.remove('text-gray-500');
          btn.classList.add('orange-accent');
        } else {
          btn.classList.add('text-gray-500');
          btn.classList.remove('orange-accent');
        }
      });

      if (tabName === 'meals') renderMeals();
      if (tabName === 'shopping') renderShoppingList();
    }

    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', () => switchTab(btn.dataset.tab));
    });

    document.getElementById('close-modal').addEventListener('click', closeRecipeModal);

    document.getElementById('recipe-modal').addEventListener('click', (e) => {
      if (e.target.id === 'recipe-modal') {
        closeRecipeModal();
      }
    });

    document.getElementById('json-file-input').addEventListener('change', (e) => {
      const fileDisplay = document.getElementById('file-name-display');
      if (e.target.files.length > 0) {
        fileDisplay.textContent = `ðŸ“„ ${e.target.files[0].name}`;
        fileDisplay.classList.remove('hidden');
      } else {
        fileDisplay.classList.add('hidden');
      }
    });

    document.getElementById('upload-json-btn').addEventListener('click', () => {
      const fileInput = document.getElementById('json-file-input');
      const file = fileInput.files[0];
      
      if (!file) {
        showToast('Please select a JSON file first', 'error');
        return;
      }
      
      const reader = new FileReader();
      reader.onload = (e) => {
        try {
          const newData = JSON.parse(e.target.result);
          appData = newData;
          saveData();
          showToast('JSON loaded successfully!', 'success');
          renderMeals();
          renderShoppingList();
          fileInput.value = '';
          document.getElementById('file-name-display').classList.add('hidden');
        } catch (err) {
          showToast('Invalid JSON file format', 'error');
        }
      };
      reader.readAsText(file);
    });

    document.getElementById('download-json-btn').addEventListener('click', () => {
      const dataStr = JSON.stringify(appData, null, 2);
      const blob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'plate-meals.json';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      showToast('Download started', 'success');
    });

    document.getElementById('reset-data-btn').addEventListener('click', () => {
      if (confirm('Reset all data to default?')) {
        appData = JSON.parse(JSON.stringify(DEFAULT_DATA));
        checkedItems = {};
        saveData();
        saveCheckedItems();
        showToast('Data reset to default', 'success');
        renderMeals();
        renderShoppingList();
      }
    });

    // SWIPE GESTURES WITH SMOOTH FINGER TRACKING
    let touchStartX = 0;
    let touchStartY = 0;
    let currentX = 0;
    let isDragging = false;
    
    // Recipe Modal Swipe Right to Close
    const recipeModal = document.getElementById('recipe-modal');
    
    recipeModal.addEventListener('touchstart', (e) => {
      touchStartX = e.touches[0].clientX;
      touchStartY = e.touches[0].clientY;
      isDragging = false;
    });
    
    recipeModal.addEventListener('touchmove', (e) => {
      const deltaY = Math.abs(e.touches[0].clientY - touchStartY);
      const deltaX = e.touches[0].clientX - touchStartX;
      
      if (!isDragging && Math.abs(deltaX) > deltaY && deltaX > 10) {
        isDragging = true;
      }
      
      if (isDragging && deltaX > 0) {
        currentX = deltaX;
        recipeModal.style.transform = `translateX(${deltaX}px)`;
        recipeModal.style.opacity = 1 - (deltaX / window.innerWidth) * 0.5;
      }
    });
    
    recipeModal.addEventListener('touchend', () => {
      if (isDragging) {
        recipeModal.style.transition = 'transform 0.3s cubic-bezier(0.4, 0.0, 0.2, 1), opacity 0.3s ease-out';
        
        if (currentX > window.innerWidth * 0.4) {
          recipeModal.style.transform = 'translateX(100%)';
          recipeModal.style.opacity = '0';
          setTimeout(() => {
            closeRecipeModal();
            recipeModal.style.transform = '';
            recipeModal.style.opacity = '';
            recipeModal.style.transition = '';
          }, 300);
        } else {
          recipeModal.style.transform = '';
          recipeModal.style.opacity = '';
          setTimeout(() => {
            recipeModal.style.transition = '';
          }, 300);
        }
        
        isDragging = false;
        currentX = 0;
      }
    });
    
    // Tab Swipe Gestures
    const tabOrder = ['meals', 'shopping', 'settings'];
    let tabStartX = 0;
    let tabStartY = 0;
    let isTabSwiping = false;
    let tabDeltaX = 0;
    
    const tabContainer = document.querySelector('.flex-1.overflow-hidden');
    
    tabContainer.addEventListener('touchstart', (e) => {
      if (!recipeModal.classList.contains('hidden')) return;
      
      tabStartX = e.touches[0].clientX;
      tabStartY = e.touches[0].clientY;
      isTabSwiping = false;
    });
    
    tabContainer.addEventListener('touchmove', (e) => {
      if (!recipeModal.classList.contains('hidden')) return;
      
      const deltaY = Math.abs(e.touches[0].clientY - tabStartY);
      const deltaX = e.touches[0].clientX - tabStartX;
      
      if (!isTabSwiping && Math.abs(deltaX) > deltaY && Math.abs(deltaX) > 15) {
        isTabSwiping = true;
        
        const currentIndex = tabOrder.indexOf(currentTab);
        const currentPanel = document.getElementById(`${currentTab}-tab`);
        
        if (deltaX < 0) {
          const nextIndex = (currentIndex + 1) % tabOrder.length;
          const nextPanel = document.getElementById(`${tabOrder[nextIndex]}-tab`);
          nextPanel.classList.remove('hidden');
          nextPanel.style.transform = 'translateX(100%)';
          nextPanel.style.opacity = '0';
        } else {
          const prevIndex = (currentIndex - 1 + tabOrder.length) % tabOrder.length;
          const prevPanel = document.getElementById(`${tabOrder[prevIndex]}-tab`);
          prevPanel.classList.remove('hidden');
          prevPanel.style.transform = 'translateX(-100%)';
          prevPanel.style.opacity = '0';
        }
      }
      
      if (isTabSwiping) {
        tabDeltaX = e.touches[0].clientX - tabStartX;
        const currentPanel = document.getElementById(`${currentTab}-tab`);
        const currentIndex = tabOrder.indexOf(currentTab);
        const screenWidth = window.innerWidth;
        
        currentPanel.style.transform = `translateX(${tabDeltaX}px)`;
        currentPanel.style.opacity = 1 - Math.abs(tabDeltaX) / screenWidth * 0.5;
        
        if (tabDeltaX < 0) {
          const nextIndex = (currentIndex + 1) % tabOrder.length;
          const nextPanel = document.getElementById(`${tabOrder[nextIndex]}-tab`);
          nextPanel.style.transform = `translateX(${screenWidth + tabDeltaX}px)`;
          nextPanel.style.opacity = Math.abs(tabDeltaX) / screenWidth;
        } else {
          const prevIndex = (currentIndex - 1 + tabOrder.length) % tabOrder.length;
          const prevPanel = document.getElementById(`${tabOrder[prevIndex]}-tab`);
          prevPanel.style.transform = `translateX(${-screenWidth + tabDeltaX}px)`;
          prevPanel.style.opacity = Math.abs(tabDeltaX) / screenWidth;
        }
      }
    });
    
    tabContainer.addEventListener('touchend', () => {
      if (!recipeModal.classList.contains('hidden')) return;
      
      if (isTabSwiping) {
        const currentPanel = document.getElementById(`${currentTab}-tab`);
        const currentIndex = tabOrder.indexOf(currentTab);
        const screenWidth = window.innerWidth;
        const threshold = screenWidth * 0.3;
        
        currentPanel.style.transition = 'transform 0.3s cubic-bezier(0.4, 0.0, 0.2, 1), opacity 0.3s ease-out';
        
        if (Math.abs(tabDeltaX) > threshold) {
          if (tabDeltaX < 0) {
            const nextIndex = (currentIndex + 1) % tabOrder.length;
            const nextPanel = document.getElementById(`${tabOrder[nextIndex]}-tab`);
            nextPanel.style.transition = 'transform 0.3s cubic-bezier(0.4, 0.0, 0.2, 1), opacity 0.3s ease-out';
            
            currentPanel.style.transform = `translateX(-${screenWidth}px)`;
            currentPanel.style.opacity = '0';
            nextPanel.style.transform = 'translateX(0)';
            nextPanel.style.opacity = '1';
            
            setTimeout(() => {
              switchTab(tabOrder[nextIndex]);
              currentPanel.style.transform = '';
              currentPanel.style.opacity = '';
              currentPanel.style.transition = '';
              nextPanel.style.transform = '';
              nextPanel.style.opacity = '';
              nextPanel.style.transition = '';
            }, 300);
          } else {
            const prevIndex = (currentIndex - 1 + tabOrder.length) % tabOrder.length;
            const prevPanel = document.getElementById(`${tabOrder[prevIndex]}-tab`);
            prevPanel.style.transition = 'transform 0.3s cubic-bezier(0.4, 0.0, 0.2, 1), opacity 0.3s ease-out';
            
            currentPanel.style.transform = `translateX(${screenWidth}px)`;
            currentPanel.style.opacity = '0';
            prevPanel.style.transform = 'translateX(0)';
            prevPanel.style.opacity = '1';
            
            setTimeout(() => {
              switchTab(tabOrder[prevIndex]);
              currentPanel.style.transform = '';
              currentPanel.style.opacity = '';
              currentPanel.style.transition = '';
              prevPanel.style.transform = '';
              prevPanel.style.opacity = '';
              prevPanel.style.transition = '';
            }, 300);
          }
        } else {
          currentPanel.style.transform = '';
          currentPanel.style.opacity = '';
          
          if (tabDeltaX < 0) {
            const nextIndex = (currentIndex + 1) % tabOrder.length;
            const nextPanel = document.getElementById(`${tabOrder[nextIndex]}-tab`);
            nextPanel.style.transition = 'transform 0.3s cubic-bezier(0.4, 0.0, 0.2, 1), opacity 0.3s ease-out';
            nextPanel.style.transform = 'translateX(100%)';
            nextPanel.style.opacity = '0';
            setTimeout(() => {
              nextPanel.classList.add('hidden');
              nextPanel.style.transform = '';
              nextPanel.style.opacity = '';
              nextPanel.style.transition = '';
            }, 300);
          } else {
            const prevIndex = (currentIndex - 1 + tabOrder.length) % tabOrder.length;
            const prevPanel = document.getElementById(`${tabOrder[prevIndex]}-tab`);
            prevPanel.style.transition = 'transform 0.3s cubic-bezier(0.4, 0.0, 0.2, 1), opacity 0.3s ease-out';
            prevPanel.style.transform = 'translateX(-100%)';
            prevPanel.style.opacity = '0';
            setTimeout(() => {
              prevPanel.classList.add('hidden');
              prevPanel.style.transform = '';
              prevPanel.style.opacity = '';
              prevPanel.style.transition = '';
            }, 300);
          }
          
          setTimeout(() => {
            currentPanel.style.transition = '';
          }, 300);
        }
        
        isTabSwiping = false;
        tabDeltaX = 0;
      }
    });

    renderMeals();
  </script>
</body>
</html>
